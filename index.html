<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>情侣AI助手 - DeepSeek真AI版</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- PWA配置 -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="light-content">
    <meta name="apple-mobile-web-app-title" content="情侣AI助手">
    <meta name="theme-color" content="#EC4899">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'love-pink': '#EC4899',
                        'love-purple': '#8B5CF6',
                        'love-blue': '#3B82F6'
                    }
                }
            }
        }
    </script>
    
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #EC4899 0%, #8B5CF6 50%, #3B82F6 100%);
        }
        .heart-beat {
            animation: heartBeat 1.5s ease-in-out infinite;
        }
        @keyframes heartBeat {
            0% { transform: scale(1); }
            14% { transform: scale(1.1); }
            28% { transform: scale(1); }
            42% { transform: scale(1.1); }
            70% { transform: scale(1); }
        }
        .typing-dots {
            animation: typing 1.4s infinite ease-in-out;
        }
        @keyframes typing {
            0%, 80%, 100% { opacity: 0; }
            40% { opacity: 1; }
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 min-h-screen">
    <!-- 用户选择界面 -->
    <div id="userSelection" class="min-h-screen flex items-center justify-center p-4">
        <div class="text-center">
            <div class="gradient-bg rounded-full w-24 h-24 mx-auto mb-6 flex items-center justify-center">
                <span class="text-4xl text-white heart-beat">🤖</span>
            </div>
            <h1 class="text-3xl font-bold text-gray-800 dark:text-white mb-4">情侣AI助手</h1>
            <p class="text-gray-600 dark:text-gray-300 mb-2">真正的DeepSeek AI驱动</p>
            <p class="text-sm text-gray-500 dark:text-gray-400 mb-8">选择你的身份，开始智能恋爱之旅</p>
            
            <div class="space-y-4 max-w-sm mx-auto">
                <button onclick="selectUser('boyfriend')" 
                        class="w-full bg-blue-500 hover:bg-blue-600 text-white rounded-lg py-4 px-6 text-lg font-semibold transition-colors">
                    🤵 我是男友
                </button>
                <button onclick="selectUser('girlfriend')" 
                        class="w-full bg-pink-500 hover:bg-pink-600 text-white rounded-lg py-4 px-6 text-lg font-semibold transition-colors">
                    👩 我是女友
                </button>
            </div>
        </div>
    </div>

    <!-- 配置界面 -->
    <div id="configPanel" class="min-h-screen flex items-center justify-center p-4 hidden">
        <div class="bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full">
            <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-6 text-center">AI助手配置</h2>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        你的名字
                    </label>
                    <input type="text" id="userName" placeholder="输入你的名字" 
                           class="w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-3 text-base focus:outline-none focus:ring-2 focus:ring-love-pink bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        对方的名字
                    </label>
                    <input type="text" id="partnerName" placeholder="输入TA的名字" 
                           class="w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-3 text-base focus:outline-none focus:ring-2 focus:ring-love-pink bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        在一起的日期
                    </label>
                    <input type="date" id="anniversaryDate" 
                           class="w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-3 text-base focus:outline-none focus:ring-2 focus:ring-love-pink bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        对方的生日
                    </label>
                    <input type="date" id="partnerBirthday" 
                           class="w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-3 text-base focus:outline-none focus:ring-2 focus:ring-love-pink bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        🔑 DeepSeek API Key <span class="text-green-500">(已共享配置)</span>
                    </label>
                    <div class="bg-green-50 dark:bg-green-900/30 border border-green-200 dark:border-green-700 rounded-lg p-3">
                        <div class="flex items-center space-x-2">
                            <span class="text-green-600">✅</span>
                            <span class="text-green-700 dark:text-green-300 text-sm">AI功能已由对方配置，无需额外设置</span>
                        </div>
                    </div>
                    <details class="mt-2">
                        <summary class="text-xs text-gray-500 dark:text-gray-400 cursor-pointer hover:text-love-pink">
                            高级：使用自己的API Key
                        </summary>
                        <div class="mt-2">
                            <input type="password" id="customApiKey" placeholder="可选：输入你自己的API Key" 
                                   class="w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-love-pink bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                                <a href="https://platform.deepseek.com" target="_blank" class="text-love-pink hover:underline">获取自己的API Key</a>
                            </p>
                        </div>
                    </details>
                </div>
                
                <button onclick="saveConfig()" 
                        class="w-full gradient-bg text-white rounded-lg py-4 font-semibold transition-colors">
                    🚀 启动AI助手
                </button>
            </div>
        </div>
    </div>

    <!-- 主应用界面 -->
    <div id="mainApp" class="hidden">
        <!-- 头部 -->
        <div class="gradient-bg text-white p-4 shadow-lg">
            <div class="max-w-md mx-auto flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center">
                        <span id="userIcon" class="text-xl"></span>
                    </div>
                    <div>
                        <h1 class="font-bold text-lg" id="appTitle"></h1>
                        <p class="text-sm opacity-90" id="subtitle"></p>
                    </div>
                </div>
                <div class="flex items-center space-x-2">
                    <div id="aiStatus" class="text-xs bg-white/20 px-2 py-1 rounded">
                        <span id="aiStatusText">🤖 AI就绪</span>
                    </div>
                    <button onclick="showSettings()" class="text-white">⚙️</button>
                </div>
            </div>
        </div>

        <div class="max-w-md mx-auto">
            <!-- AI智能建议（置顶） -->
            <div class="m-4 bg-white dark:bg-gray-800 rounded-lg shadow-md p-4">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="font-bold text-lg text-gray-800 dark:text-white flex items-center">
                        🤖 DeepSeek AI建议
                    </h3>
                    <div class="flex space-x-2">
                        <span id="aiCostEstimate" class="text-xs text-gray-500"></span>
                    </div>
                </div>
                <div id="aiSuggestions">
                    <div class="text-gray-600 dark:text-gray-400 text-center py-4">
                        正在初始化AI助手...
                    </div>
                </div>
                <div class="flex space-x-2 mt-3">
                    <button onclick="generateAISuggestions()" 
                            class="flex-1 gradient-bg text-white rounded-lg py-2 font-semibold flex items-center justify-center space-x-2">
                        <span>🧠</span>
                        <span>AI智能建议</span>
                    </button>
                    <button onclick="askCustomAI()" 
                            class="px-4 py-2 border-2 border-love-pink text-love-pink rounded-lg font-semibold hover:bg-love-pink hover:text-white transition-colors">
                        💬
                    </button>
                </div>
            </div>

            <!-- 今日提醒卡片 -->
            <div class="m-4 bg-white dark:bg-gray-800 rounded-lg shadow-md p-4">
                <h3 class="font-bold text-lg text-gray-800 dark:text-white mb-3 flex items-center">
                    📅 今日提醒
                </h3>
                <div id="dailyReminders" class="space-y-2">
                    <!-- 动态生成提醒内容 -->
                </div>
            </div>

            <!-- 其他功能保持不变... -->
            <!-- 这里继续添加其他功能模块 -->
        </div>
    </div>

    <!-- AI聊天对话框 -->
    <div id="aiChatModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="min-h-screen flex items-center justify-center p-4">
            <div class="bg-white dark:bg-gray-800 rounded-lg max-w-md w-full h-96 flex flex-col">
                <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                    <h3 class="text-lg font-bold text-gray-800 dark:text-white">💬 AI聊天</h3>
                    <button onclick="closeAIChat()" class="text-gray-500 hover:text-gray-700">✕</button>
                </div>
                <div id="chatMessages" class="flex-1 overflow-y-auto p-4 space-y-3">
                    <!-- 聊天消息 -->
                </div>
                <div class="p-4 border-t border-gray-200 dark:border-gray-700">
                    <div class="flex space-x-2">
                        <input type="text" id="chatInput" placeholder="问AI任何恋爱问题..." 
                               class="flex-1 border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-base focus:outline-none focus:ring-2 focus:ring-love-pink bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                        <button onclick="sendAIMessage()" 
                                class="gradient-bg text-white px-4 py-2 rounded-lg font-semibold">
                            发送
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 应用状态
        let appState = {
            userType: '',
            userName: '',
            partnerName: '',
            anniversaryDate: '',
            partnerBirthday: '',
            apiKey: '',
            aiCallCount: 0,
            totalCost: 0
        };

        // 用户选择函数
        function selectUser(type) {
            appState.userType = type;
            document.getElementById('userSelection').classList.add('hidden');
            document.getElementById('configPanel').classList.remove('hidden');
        }

        // 🔐 预设共享API Key配置
        const SHARED_API_KEY = 'sk-1485e44b18f64bf994b6bde5da7c27f4'; // ← 在这里配置你的API Key
        
        // 💰 成本控制配置
        const COST_CONTROL = {
            maxCallsPerDay: 10000,        // 每天最大调用次数
            maxCallsPerHour: 200,        // 每小时最大调用次数
            alertThreshold: 500,         // 达到多少次时提醒
            estimatedCostPerCall: 0.000007  // 每次调用估算成本(元)
        };
        
        // 保存配置
        function saveConfig() {
            appState.userName = document.getElementById('userName').value;
            appState.partnerName = document.getElementById('partnerName').value;
            appState.anniversaryDate = document.getElementById('anniversaryDate').value;
            appState.partnerBirthday = document.getElementById('partnerBirthday').value;
            
            // 优先使用自定义API Key，否则使用共享API Key
            const customApiKey = document.getElementById('customApiKey').value;
            appState.apiKey = customApiKey || SHARED_API_KEY;

            if (!appState.userName || !appState.partnerName) {
                showCustomAlert('请填写姓名信息');
                return;
            }

            if (!appState.apiKey || !appState.apiKey.startsWith('sk-')) {
                showCustomAlert('API Key配置错误\n请联系对方检查共享配置');
                return;
            }

            // 保存到本地存储
            localStorage.setItem('coupleAI', JSON.stringify(appState));

            // 显示主应用
            initMainApp();
        }

        // 初始化主应用
        function initMainApp() {
            document.getElementById('configPanel').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');

            // 设置界面
            const userIcon = appState.userType === 'boyfriend' ? '🤵' : '👩';
            const title = appState.userType === 'boyfriend' ? 'AI男友助手' : 'AI女友助手';
            
            document.getElementById('userIcon').textContent = userIcon;
            document.getElementById('appTitle').textContent = title;
            document.getElementById('subtitle').textContent = `为 ${appState.partnerName} 专属定制`;

            // 生成提醒和建议
            generateDailyReminders();
            generateAISuggestions();
            updateRelationshipDays();
        }

        // 🤖 真正的DeepSeek AI建议生成
        async function generateAISuggestions() {
            const aiSuggestionsDiv = document.getElementById('aiSuggestions');
            
            // 检查API Key
            if (!appState.apiKey || appState.apiKey.trim() === '') {
                aiSuggestionsDiv.innerHTML = `
                    <div class="bg-yellow-50 dark:bg-yellow-900/30 border border-yellow-200 dark:border-yellow-700 rounded-lg p-4">
                        <div class="flex items-start space-x-3">
                            <div class="text-2xl">⚠️</div>
                            <div class="flex-1">
                                <p class="text-yellow-800 dark:text-yellow-200 font-semibold">需要配置DeepSeek API Key</p>
                                <p class="text-yellow-700 dark:text-yellow-300 text-sm mt-1">
                                    请配置API Key来享受真正的AI建议
                                </p>
                                <button onclick="showSettings()" class="mt-2 bg-yellow-500 text-white px-3 py-1 rounded text-sm">
                                    去配置
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                return;
            }
            
            // 显示AI加载状态
            updateAIStatus('thinking');
            aiSuggestionsDiv.innerHTML = `
                <div class="bg-gradient-to-r from-love-pink to-love-purple text-white rounded-lg p-4">
                    <div class="flex items-center space-x-3">
                        <div class="text-2xl">🤖</div>
                        <div class="flex-1">
                            <div class="flex items-center space-x-2">
                                <div class="flex space-x-1">
                                    <div class="w-2 h-2 bg-white rounded-full typing-dots"></div>
                                    <div class="w-2 h-2 bg-white rounded-full typing-dots" style="animation-delay: 0.2s"></div>
                                    <div class="w-2 h-2 bg-white rounded-full typing-dots" style="animation-delay: 0.4s"></div>
                                </div>
                                <span>DeepSeek AI正在思考专属建议...</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            try {
                // 构建个性化上下文
                const context = buildUserContext();
                const prompt = generateAIPrompt(context);
                
                // 调用DeepSeek API
                const aiResponse = await callDeepSeekAPI(prompt);
                
                // 更新使用统计
                appState.aiCallCount++;
                appState.totalCost += 0.000007; // 估算成本
                updateCostDisplay();
                
                // 显示AI建议
                const suggestionHTML = `
                    <div class="bg-gradient-to-r from-love-pink to-love-purple text-white rounded-lg p-4">
                        <div class="flex items-start space-x-3">
                            <div class="text-2xl">🤖</div>
                            <div class="flex-1">
                                <p class="text-white leading-relaxed">${aiResponse}</p>
                                <div class="text-xs mt-2 opacity-75 flex justify-between">
                                    <span>✨ DeepSeek AI生成</span>
                                    <span>调用 #${appState.aiCallCount}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                aiSuggestionsDiv.innerHTML = suggestionHTML;
                updateAIStatus('ready');

            } catch (error) {
                console.error('DeepSeek API调用失败:', error);
                updateAIStatus('error');
                
                // AI失败时的错误显示
                const suggestionHTML = `
                    <div class="bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-700 rounded-lg p-4">
                        <div class="flex items-start space-x-3">
                            <div class="text-2xl">❌</div>
                            <div class="flex-1">
                                <p class="text-red-800 dark:text-red-200 font-semibold">AI调用失败</p>
                                <p class="text-red-700 dark:text-red-300 text-sm mt-1">
                                    ${getErrorMessage(error)}
                                </p>
                                <button onclick="generateAISuggestions()" 
                                        class="mt-2 bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600">
                                    重试
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                aiSuggestionsDiv.innerHTML = suggestionHTML;
            }
        }

        // 构建用户上下文
        function buildUserContext() {
            const relationshipDays = calculateRelationshipDays();
            const timeOfDay = new Date().getHours();
            const dayOfWeek = ['周日','周一','周二','周三','周四','周五','周六'][new Date().getDay()];
            
            return {
                userType: appState.userType,
                partnerName: appState.partnerName,
                relationshipDays: relationshipDays,
                timeOfDay: timeOfDay,
                dayOfWeek: dayOfWeek
            };
        }

        // 生成AI提示词
        function generateAIPrompt(context) {
            const userTypeText = context.userType === 'boyfriend' ? '男友' : '女友';
            const timeText = getTimeDescription(context.timeOfDay);
            const relationshipText = context.relationshipDays > 0 ? `我们在一起${context.relationshipDays}天了` : '我们是新恋人';
            
            const prompt = `我是${userTypeText}，${relationshipText}。现在是${context.dayOfWeek}${timeText}。

请给我一个具体的、可执行的恋爱建议：
1. 针对${context.userType === 'boyfriend' ? '如何对女友更好' : '如何对男友更贴心'}
2. 考虑当前时间和情境
3. 简洁实用，25字以内
4. 温暖有爱，符合中国情侣习惯
5. 直接给建议，不要多余解释

建议：`;

            return prompt;
        }

        // 时间描述
        function getTimeDescription(hour) {
            if (hour >= 6 && hour < 9) return '早上';
            if (hour >= 9 && hour < 12) return '上午';
            if (hour >= 12 && hour < 14) return '中午';
            if (hour >= 14 && hour < 18) return '下午';
            if (hour >= 18 && hour < 22) return '晚上';
            return '深夜';
        }

        // 🔥 调用DeepSeek API的核心函数
        async function callDeepSeekAPI(prompt) {
            const response = await fetch('https://api.deepseek.com/chat/completions', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${appState.apiKey}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    model: 'deepseek-chat',
                    messages: [
                        {
                            role: 'system',
                            content: '你是专业的恋爱顾问AI，专门为情侣提供个性化建议。回答要简洁、实用、温暖。'
                        },
                        {
                            role: 'user',
                            content: prompt
                        }
                    ],
                    temperature: 0.8,
                    max_tokens: 100,
                    top_p: 0.9
                })
            });

            if (!response.ok) {
                const errorData = await response.json().catch(() => ({}));
                throw new Error(errorData.error?.message || `HTTP ${response.status}`);
            }

            const data = await response.json();
            let aiMessage = data.choices[0].message.content.trim();
            
            // 清理回复
            aiMessage = aiMessage.replace(/^(建议：|答：|回答：)/, '').trim();
            
            return aiMessage;
        }

        // AI状态更新
        function updateAIStatus(status) {
            const statusElement = document.getElementById('aiStatusText');
            const statusMap = {
                'ready': '🤖 AI就绪',
                'thinking': '🧠 AI思考中',
                'error': '❌ AI错误'
            };
            statusElement.textContent = statusMap[status] || '🤖 AI就绪';
        }

        // 成本显示更新
        function updateCostDisplay() {
            const costElement = document.getElementById('aiCostEstimate');
            if (appState.aiCallCount > 0) {
                costElement.textContent = `已调用${appState.aiCallCount}次`;
            }
        }

        // 错误信息处理
        function getErrorMessage(error) {
            const message = error.message || error.toString();
            if (message.includes('401')) return 'API Key无效，请检查配置';
            if (message.includes('403')) return 'API访问被拒绝，请检查权限';
            if (message.includes('429')) return 'API调用过于频繁，请稍后重试';
            if (message.includes('insufficient_quota')) return 'API额度不足，请充值';
            return `网络错误: ${message}`;
        }

        // 自定义AI聊天
        function askCustomAI() {
            document.getElementById('aiChatModal').classList.remove('hidden');
            document.getElementById('chatInput').focus();
        }

        function closeAIChat() {
            document.getElementById('aiChatModal').classList.add('hidden');
        }

        async function sendAIMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            const messagesDiv = document.getElementById('chatMessages');
            
            // 添加用户消息
            messagesDiv.innerHTML += `
                <div class="flex justify-end">
                    <div class="bg-love-pink text-white rounded-lg px-3 py-2 max-w-xs">
                        ${message}
                    </div>
                </div>
            `;
            
            // 添加AI思考中
            messagesDiv.innerHTML += `
                <div class="flex justify-start">
                    <div class="bg-gray-200 dark:bg-gray-700 rounded-lg px-3 py-2 max-w-xs">
                        <div class="flex items-center space-x-2">
                            <div class="typing-dots">●</div>
                            <div class="typing-dots">●</div>
                            <div class="typing-dots">●</div>
                        </div>
                    </div>
                </div>
            `;
            
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
            input.value = '';
            
            try {
                const aiResponse = await callDeepSeekAPI(`作为${appState.userType === 'boyfriend' ? '男友' : '女友'}，我想问：${message}`);
                
                // 移除思考中，添加AI回复
                const children = messagesDiv.children;
                messagesDiv.removeChild(children[children.length - 1]);
                
                messagesDiv.innerHTML += `
                    <div class="flex justify-start">
                        <div class="bg-gray-200 dark:bg-gray-700 rounded-lg px-3 py-2 max-w-xs">
                            <div class="text-gray-800 dark:text-gray-200">${aiResponse}</div>
                        </div>
                    </div>
                `;
                
                appState.aiCallCount++;
                updateCostDisplay();
                
            } catch (error) {
                // 移除思考中，添加错误信息
                const children = messagesDiv.children;
                messagesDiv.removeChild(children[children.length - 1]);
                
                messagesDiv.innerHTML += `
                    <div class="flex justify-start">
                        <div class="bg-red-100 border border-red-300 rounded-lg px-3 py-2 max-w-xs">
                            <div class="text-red-800 text-sm">AI暂时无法回复: ${getErrorMessage(error)}</div>
                        </div>
                    </div>
                `;
            }
            
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        // 计算恋爱天数
        function calculateRelationshipDays() {
            if (!appState.anniversaryDate) return 0;
            const anniversary = new Date(appState.anniversaryDate);
            const today = new Date();
            return Math.floor((today - anniversary) / (1000 * 60 * 60 * 24));
        }

        // 生成每日提醒
        function generateDailyReminders() {
            const reminders = [];
            const today = new Date();

            // 检查生日提醒
            if (appState.partnerBirthday) {
                const birthday = new Date(appState.partnerBirthday);
                const thisYearBirthday = new Date(today.getFullYear(), birthday.getMonth(), birthday.getDate());
                const daysToBirthday = Math.ceil((thisYearBirthday - today) / (1000 * 60 * 60 * 24));
                
                if (daysToBirthday >= 0 && daysToBirthday <= 7) {
                    reminders.push({
                        icon: '🎂',
                        text: daysToBirthday === 0 ? `今天是${appState.partnerName}的生日！` : `${appState.partnerName}的生日还有${daysToBirthday}天`
                    });
                }
            }

            // 默认提醒
            if (reminders.length === 0) {
                reminders.push({
                    icon: '💝',
                    text: '今天也要好好爱TA哦，试试AI建议吧！'
                });
            }

            const reminderHTML = reminders.map(reminder => 
                `<div class="flex items-center space-x-2 text-gray-600 dark:text-gray-400">
                    <span>${reminder.icon}</span>
                    <span>${reminder.text}</span>
                </div>`
            ).join('');

            document.getElementById('dailyReminders').innerHTML = reminderHTML;
        }

        // 自定义提示框
        function showCustomAlert(message) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full mx-4">
                    <p class="text-gray-700 dark:text-gray-300 mb-4">${message}</p>
                    <button onclick="this.closest('.fixed').remove()" 
                            class="w-full gradient-bg text-white py-2 rounded-lg font-semibold">
                        确定
                    </button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // 设置功能（简化版）
        function showSettings() {
            showCustomAlert(`当前API Key: ${appState.apiKey.substring(0, 8)}***\n已调用AI ${appState.aiCallCount} 次`);
        }

        // 回车发送消息
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && document.getElementById('aiChatModal').style.display !== 'none') {
                sendAIMessage();
            }
        });

        // 页面加载时检查保存的数据
        window.addEventListener('load', function() {
            const savedData = localStorage.getItem('coupleAI');
            if (savedData) {
                appState = JSON.parse(savedData);
                initMainApp();
            }
        });

        // 自动初始化AI建议
        setTimeout(() => {
            if (appState.apiKey) {
                generateAISuggestions();
            }
        }, 1000);
    </script>
</body>
</html>
